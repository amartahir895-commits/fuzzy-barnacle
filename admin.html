<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>body{font-family:'Poppins',sans-serif;}</style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen pb-20">

    <!-- Navbar -->
    <nav class="bg-white border-b px-4 py-4 sticky top-0 z-50 shadow-sm flex justify-between items-center">
        <h1 class="font-bold text-lg text-indigo-700 flex items-center gap-2">
            <i class="fas fa-layer-group"></i> <span id="userDisplay">Admin</span>
        </h1>
        <button onclick="logout()" class="text-xs font-bold text-red-500 bg-red-50 px-3 py-1 rounded-full border border-red-100">Logout</button>
    </nav>

    <div class="container mx-auto px-4 mt-6 max-w-3xl">
        
        <!-- Generated Link Card -->
        <div class="bg-gradient-to-r from-indigo-700 to-purple-700 rounded-2xl p-5 text-white mb-6 shadow-xl">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h2 class="font-bold text-lg">Your Public Link ðŸš€</h2>
                    <p class="text-xs text-indigo-200">Share this link. No database needed.</p>
                </div>
            </div>
            
            <!-- Link Input Group -->
            <div class="flex flex-col sm:flex-row gap-2 mt-3 bg-white/10 p-2 rounded-xl border border-white/20">
                <input type="text" id="finalLink" readonly class="bg-transparent text-white text-xs w-full outline-none px-2 truncate" placeholder="Click Update to generate link...">
                <div class="flex gap-2 shrink-0">
                    <button onclick="generateLink()" class="bg-white text-indigo-700 px-3 py-2 rounded-lg text-xs font-bold hover:bg-gray-100">
                        <i class="fas fa-sync-alt"></i> Update
                    </button>
                    <button onclick="copyLink()" class="bg-indigo-900 text-white px-3 py-2 rounded-lg text-xs font-bold hover:bg-black">
                        Copy
                    </button>
                    <a id="previewBtn" href="#" target="_blank" class="bg-indigo-500/50 text-white px-3 py-2 rounded-lg text-xs font-bold hover:bg-indigo-500">
                        View
                    </a>
                </div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
            
            <!-- LEFT: Profile Info -->
            <div class="space-y-6">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-700 mb-4 text-sm uppercase tracking-wider border-b pb-2">Profile Details</h3>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs font-bold text-gray-500">Display Name</label>
                            <input type="text" id="pTitle" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm outline-none focus:border-indigo-500 transition">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500">Bio / Description</label>
                            <textarea id="pDesc" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm outline-none focus:border-indigo-500 transition"></textarea>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500">Logo Image Link (URL)</label>
                            <div class="flex gap-2">
                                <input type="url" id="pAvatar" placeholder="https://..." class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm outline-none focus:border-indigo-500 transition">
                                <img id="imgPreview" src="https://via.placeholder.com/40" class="w-10 h-10 rounded-lg object-cover bg-gray-200">
                            </div>
                            <p class="text-[10px] text-gray-400 mt-1">Tip: Copy image link from Discord or Google.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Add Tools -->
            <div class="space-y-6">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                    <h3 class="font-bold text-gray-700 mb-4 text-sm uppercase tracking-wider border-b pb-2">Add Tool</h3>
                    
                    <form id="addForm" class="space-y-3">
                        <input type="text" id="tName" placeholder="Tool Name (e.g. ChatGPT)" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm" required>
                        <input type="url" id="tUrl" placeholder="Link (https://...)" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm" required>
                        <input type="url" id="tImg" placeholder="Icon Image Link (Optional)" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm">
                        
                        <button type="submit" class="w-full bg-gray-900 text-white py-2.5 rounded-xl font-bold text-sm hover:bg-black transition shadow-lg">
                            <i class="fas fa-plus mr-1"></i> Add to List
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Tools List -->
        <div class="mt-8">
            <h3 class="font-bold text-gray-700 mb-4 text-sm uppercase tracking-wider ml-1">Your Tools List</h3>
            <div id="toolList" class="space-y-3 pb-10">
                <!-- Items will appear here -->
            </div>
        </div>

    </div>

    <script>
        // Check Login
        const currentUser = localStorage.getItem('currentUser');
        if(!currentUser) window.location.href = 'index.html';
        document.getElementById('userDisplay').innerText = currentUser;

        // Data State
        let data = {
            title: currentUser + " Toolkit",
            desc: "Welcome to my official tools page.",
            avatar: "",
            links: []
        };

        // Load from Browser Memory
        const savedData = localStorage.getItem(`data_${currentUser}`);
        if(savedData) {
            data = JSON.parse(savedData);
            updateInputs();
            renderList();
        }

        // Functions
        function updateInputs() {
            document.getElementById('pTitle').value = data.title;
            document.getElementById('pDesc').value = data.desc;
            document.getElementById('pAvatar').value = data.avatar;
            document.getElementById('imgPreview').src = data.avatar || 'https://via.placeholder.com/40';
        }

        document.getElementById('pAvatar').addEventListener('input', function() {
            document.getElementById('imgPreview').src = this.value || 'https://via.placeholder.com/40';
        });

        // Add Tool
        document.getElementById('addForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const newItem = {
                name: document.getElementById('tName').value,
                url: document.getElementById('tUrl').value,
                img: document.getElementById('tImg').value
            };
            data.links.push(newItem);
            saveData();
            e.target.reset();
        });

        // Render List
        function renderList() {
            const list = document.getElementById('toolList');
            list.innerHTML = '';
            if(data.links.length === 0) list.innerHTML = '<p class="text-center text-gray-400 text-sm">No tools added yet.</p>';

            data.links.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between';
                div.innerHTML = `
                    <div class="flex items-center gap-3 overflow-hidden">
                        <img src="${item.img || 'https://via.placeholder.com/40'}" class="w-10 h-10 rounded-lg object-cover bg-gray-50 shrink-0">
                        <div class="min-w-0">
                            <h4 class="font-bold text-sm text-gray-800 truncate">${item.name}</h4>
                            <p class="text-xs text-gray-400 truncate">${item.url}</p>
                        </div>
                    </div>
                    <button onclick="removeTool(${index})" class="text-red-400 hover:text-red-600 p-2"><i class="fas fa-trash"></i></button>
                `;
                list.appendChild(div);
            });
        }

        window.removeTool = (index) => {
            data.links.splice(index, 1);
            saveData();
        }

        // Save & Generate
        function saveData() {
            // Update Profile fields first
            data.title = document.getElementById('pTitle').value;
            data.desc = document.getElementById('pDesc').value;
            data.avatar = document.getElementById('pAvatar').value;

            // Save to LocalStorage
            localStorage.setItem(`data_${currentUser}`, JSON.stringify(data));
            renderList();
        }

        window.generateLink = () => {
            saveData();
            // Encode Data to Base64 for URL
            const jsonString = JSON.stringify(data);
            const encoded = btoa(encodeURIComponent(jsonString));
            
            // Construct URL
            const url = `${window.location.origin}${window.location.pathname.replace('admin.html', 'view.html')}?d=${encoded}`;
            
            document.getElementById('finalLink').value = url;
            document.getElementById('previewBtn').href = url;
            alert("Link Updated! Click Copy to share.");
        };

        window.copyLink = () => {
            const copyText = document.getElementById("finalLink");
            if(!copyText.value) return alert("Click 'Update' first!");
            copyText.select();
            navigator.clipboard.writeText(copyText.value);
            alert("Copied to clipboard!");
        };

        window.logout = () => {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        };
    </script>
</body>
</html>
